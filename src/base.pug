doctype html
html
  head
    meta(charset='utf-8')
    meta(name='viewport', content='width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no')
    link(rel='stylesheet', href='https://res.wx.qq.com/open/libs/weui/1.1.2/weui.min.css')
    link(rel='stylesheet', href='https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css')
    script(src='https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.0.8/handlebars.min.js')
  body
    #uinfo.dropdown.headnav
    #cont
    .container#page-hook
      .page.page__bd
    #cont2(style='z-index:10000;text-align:center;width:100%;position:absolute;top:100px;display:none')
      //- img(style='max-width: 10%;margin: 40% 0', src='./3rd/images/indicator.gif')
    script.
      // this block is for UI developer
      let searchParams = new URLSearchParams(window.location.search)
      let page = searchParams.get('page')
      function fetchResource (url) {
        return new Promise( (resolve, reject)=> {
          fetch(url)
            .then((res)=>res.text())
            .then(data=>resolve(data))
        })
      }
      console.log('page ' + page)
      // get page template source
      Promise.all([fetchResource(`/${page}/template.html`),fetchResource(`/${page}/data.js`)])
      .then(results => {
        let source = results[0]
        // fill
        eval(results[1])
        var template = Handlebars.compile(source)
        var html = template(fill)
        document.querySelector('#page-hook').innerHTML = html
      })
